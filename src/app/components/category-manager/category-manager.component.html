<div class="home-container">
    <div class="header">
        <h2>Category</h2>
        <mat-icon class="clickable-icon" (click)="addNewCategory()">add</mat-icon>
    </div>

    <div class="tab-bar">
        <div class="tab-item" *ngFor="let cat of categories; let i = index" #tabItem
            [class.active]="i === activeTabIndex">
            <div (click)="activeTabIndex = i" class="tab-label">
                <mat-icon>{{ cat.matIcon || 'category' }}</mat-icon>
                {{ cat.category }}
            </div>
            <mat-icon *ngIf="!isDefaultCategory(i)" class="delete-icon" (click)="deleteCategory(i)">close</mat-icon>
        </div>
    </div>


    <div class="tab-content">
        <ng-container *ngIf="categories[activeTabIndex] as cat; else noTab">
            <div class="category-name-edit">
                <label>Category:</label>
                <input [(ngModel)]="cat.category" (ngModelChange)="updateCategoryName(activeTabIndex, $event)"
                    [readonly]="isDefaultCategory(activeTabIndex)" />


                <button class="icon-button" (click)="openIconPicker()">
                    <mat-icon>{{ cat.matIcon || 'category' }}</mat-icon>
                </button>
            </div>


            <div *ngIf="cat.staticDivisions.length > 0">
                <h4>Static Divisions</h4>
                <ul>
                    <li *ngFor="let div of cat.staticDivisions" class="readonly-division">{{ div }}</li>
                </ul>
            </div>


            <h4>Dynamic Divisions</h4>
            <ul>
                <li *ngFor="let div of cat.dynamicDivisions; let j = index" class="editable-division">
                    {{ div }}
                    <mat-icon class="icon-button" (click)="editDivision(activeTabIndex, j)">edit</mat-icon>
                    <mat-icon class="icon-button" (click)="deleteDivision(activeTabIndex, j)">delete</mat-icon>
                </li>
            </ul>

        </ng-container>

        <ng-template #noTab>
            <p>No categories available.</p>
        </ng-template>
    </div>

    <div class="footer-buttons">
        <button class="soft-btn" (click)="addDivision(activeTabIndex)">+ Add Division</button>

        <div class="spacer"></div>

        <button class="soft-btn" [disabled]="!pendingChanges" (click)="resetChanges()">Reset</button>
        <button class="soft-btn" [disabled]="!pendingChanges" (click)="saveChanges()">Save</button>
    </div>
</div>